<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rdefra">
<title>rdefra: Interact with the UK AIR Pollution Database from DEFRA â€¢ rdefra</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rdefra: Interact with the UK AIR Pollution Database from DEFRA">
<meta property="og:description" content="rdefra">
<meta property="og:image" content="https://docs.ropensci.org/rdefra/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">rdefra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.9.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="external-link dropdown-item" href="https://www.doi.org/10.21105/joss.00051">JOSS paper</a>
    <a class="dropdown-item" href="../articles/index.html">Vignette</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/rdefra">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rdefra: Interact with the UK AIR Pollution Database from DEFRA</h1>
                        <h4 data-toc-skip class="author">Claudia Vitolo</h4>
            
            <h4 data-toc-skip class="date">2022-03-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/rdefra/blob/HEAD/vignettes/rdefra_vignette.Rmd" class="external-link"><code>vignettes/rdefra_vignette.Rmd</code></a></small>
      <div class="d-none name"><code>rdefra_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The package rdefra allows to retrieve air pollution data from the Air Information Resource (UK-AIR, <a href="https://uk-air.defra.gov.uk/" class="external-link uri">https://uk-air.defra.gov.uk/</a>) of the Department for Environment, Food and Rural Affairs (DEFRA) in the United Kingdom. UK-AIR does not provide a public API for programmatic access to data, therefore this package scrapes the HTML pages to get relevant information.</p>
<p>This package follows a logic similar to other packages such as waterData and rnrfa: sites are first identified through a catalogue, data are imported via the station identification number, then visualised and/or used in analyses. The information related to the monitoring stations is accessible through the function <code><a href="../reference/ukair_catalogue.html">ukair_catalogue()</a></code>. Some station may have missing coordinates, which can be recovered using the function <code><a href="../reference/ukair_get_coordinates.html">ukair_get_coordinates()</a></code>. Lastly, time series data related to different pollutants can be obtained using the function <code><a href="../reference/ukair_get_hourly_data.html">ukair_get_hourly_data()</a></code>.</p>
<p>The package is designed to collect data efficiently. It allows to download multiple years of data for a single station with one line of code and, if used with the parallel package, allows the acquisition of data from hundreds of sites in only few minutes.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>Get the released version from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rdefra"</span><span class="op">)</span></span></code></pre></div>
<p>Or the development version from GitHub using the package <code>remotes</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/rdefra"</span><span class="op">)</span></span></code></pre></div>
<p>Load the rdefra package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rdefra/">"rdefra"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h3>
<p>The package logic assumes that users access the UK-AIR database in two steps:</p>
<ol style="list-style-type: decimal">
<li>Browse the catalogue of available stations and selects some stations of interest.</li>
<li>Retrieves data for the selected stations.</li>
</ol>
<div class="section level4">
<h4 id="get-stations-catalogue">Get stations catalogue<a class="anchor" aria-label="anchor" href="#get-stations-catalogue"></a>
</h4>
<p>The list of monitoring stations can be downloaded using the function <code><a href="../reference/ukair_catalogue.html">ukair_catalogue()</a></code> with no input parameters, as in the example below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get full catalogue</span></span>
<span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ukair_catalogue.html">ukair_catalogue</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in httr::content(resp, encoding = "UTF-8"): is.response(x) is not TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stations</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 Ã— 17</span></span>
<span><span class="co">#&gt;   UK.AIR.ID EU.Site.ID EMEP.Site.ID Site.Name  Environment.Type Zone  Start.Date          End.Date            Latitude Longitude Northing Easting Altitude..m. Networks AURN.Pollutantsâ€¦ Site.Description SiteID</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt; &lt;dttm&gt;              &lt;dttm&gt;                 &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 UKA15910  &lt;NA&gt;       &lt;NA&gt;         SH15, SH2â€¦ &lt;NA&gt;             Soutâ€¦ 2003-03-01 00:00:00 2003-10-01 00:00:00     51.3    -0.744   158876  487639         71.0 DEFRA Nâ€¦ &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; 2 UKA15956  &lt;NA&gt;       &lt;NA&gt;         SH15, SH2â€¦ &lt;NA&gt;             Soutâ€¦ 2003-08-01 00:00:00 2005-06-01 00:00:00     51.3    -0.631   158871  495503         49.9 DEFRA Nâ€¦ &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; 3 UKA16663  &lt;NA&gt;       &lt;NA&gt;         SH15, SH2â€¦ &lt;NA&gt;             Soutâ€¦ 2005-05-03 00:00:00 NA                      51.3    -0.728   159750  488750         83.0 DEFRA Nâ€¦ &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; 4 UKA16097  &lt;NA&gt;       &lt;NA&gt;         10 High Sâ€¦ &lt;NA&gt;             Soutâ€¦ 2004-03-01 00:00:00 NA                      51.2     0.272   146166  558864         NA   DEFRA Nâ€¦ &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; 5 UKA12536  &lt;NA&gt;       &lt;NA&gt;         ABBOTS LAâ€¦ &lt;NA&gt;             Greaâ€¦ 1975-04-01 00:00:00 1977-03-28 00:00:00     51.7    -0.417   201800  509500         NA   Smoke aâ€¦ &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; 6 UKA12949  &lt;NA&gt;       &lt;NA&gt;         ABERBARGOâ€¦ &lt;NA&gt;             Soutâ€¦ 1979-04-03 00:00:00 1982-03-29 00:00:00     51.7    -3.23    200300  315400         NA   Smoke aâ€¦ &lt;NA&gt;             &lt;NA&gt;             &lt;NA&gt;</span></span></code></pre></div>
<p>There are currently 6611 stations in UK-AIR. The same function, can be used to filter the catalogue using the following input parameters:</p>
<ul>
<li>
<code>site_name</code> IDs of specific site (UK.AIR.ID). By default this is left blank to get info on all the available sites.</li>
<li>
<code>pollutant</code> This is an integer between 1 and 10. Default is 9999, which means all the pollutants.</li>
<li>
<code>group_id</code> This is the identification number of a group of stations. Default is 9999 which means all available networks.</li>
<li>
<code>closed</code> This is set to TRUE to include closed stations, FALSE otherwise.</li>
<li>
<code>country_id</code> This is the identification number of the country, it can be an integer between 1 and 6. Default is 9999, which means all the countries.</li>
<li>
<code>region_id</code> This is the identification number of the region. 1 = Aberdeen City, etc. (for the full list see <a href="https://uk-air.defra.gov.uk/" class="external-link uri">https://uk-air.defra.gov.uk/</a>). Default is 9999, which means all the local authorities.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stations_EnglandOzone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ukair_catalogue.html">ukair_catalogue</a></span><span class="op">(</span>pollutant <span class="op">=</span> <span class="fl">1</span>, country_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stations_EnglandOzone</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 Ã— 16</span></span>
<span><span class="co">#&gt;   UK.AIR.ID EU.Site.ID EMEP.Site.ID Site.Name         Environment.Type Zone  Start.Date          End.Date            Latitude Longitude Northing Easting Altitude..m. Networks AURN.Pollutantsâ€¦ Site.Description</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt;            &lt;chr&gt; &lt;dttm&gt;              &lt;dttm&gt;                 &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;            &lt;chr&gt;           </span></span>
<span><span class="co">#&gt; 1 UKA00353  GB0681A    &lt;NA&gt;         Barnsley Gawber   Urban Background Yorkâ€¦ 1997-07-07 00:00:00 NA                      53.6     -1.51  407478. 432524.          100 Automatâ€¦ &lt;NA&gt;             The monitoring â€¦</span></span>
<span><span class="co">#&gt; 2 UKA00626  GB1067A    &lt;NA&gt;         Birmingham A4540â€¦ Urban Traffic    Westâ€¦ 2016-09-06 00:00:00 NA                      52.5     -1.88  286470. 408586.          109 Automatâ€¦ &lt;NA&gt;             Roadside monitoâ€¦</span></span>
<span><span class="co">#&gt; 3 UKA00559  GB1013A    &lt;NA&gt;         Birmingham Acockâ€¦ Urban Background Westâ€¦ 2011-03-18 00:00:00 NA                      52.4     -1.83  282146  411654           134 Automatâ€¦ &lt;NA&gt;             The monitoring â€¦</span></span>
<span><span class="co">#&gt; 4 UKA00214  GB0569A    &lt;NA&gt;         Birmingham Centre Urban Background Westâ€¦ 1992-03-18 00:00:00 2009-01-14 00:00:00     52.5     -1.91  286870. 406340           163 Automatâ€¦ &lt;NA&gt;             The monitoring â€¦</span></span>
<span><span class="co">#&gt; 5 UKA00229  GB0595A    &lt;NA&gt;         Birmingham East   Urban Background Westâ€¦ 1993-08-04 00:00:00 2004-10-01 00:00:00     52.5     -1.83  288872. 411536.          100 Automatâ€¦ &lt;NA&gt;             Within playgrouâ€¦</span></span>
<span><span class="co">#&gt; 6 UKA00655  GB1097A    &lt;NA&gt;         Birmingham Ladywâ€¦ Urban Background Westâ€¦ 2018-06-01 00:00:00 NA                      52.5     -1.92  287050  405650           134 Automatâ€¦ &lt;NA&gt;             &lt;NA&gt;</span></span></code></pre></div>
<p>The example above shows how to retrieve the 108 stations in England in which ozone is measured.</p>
</div>
<div class="section level4">
<h4 id="get-missing-coordinates">Get missing coordinates<a class="anchor" aria-label="anchor" href="#get-missing-coordinates"></a>
</h4>
<p>Locating a station is extremely important to be able to carry out any spatial analysis. If coordinates are missing, for some stations in the catalogue, it might be possible to retrieve Easting and Northing coordinates (British National Grid) from DEFRA web pages, transform them to latitude and longitude and populate the missing coordinates as shown below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many stations have missing coordinates?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">Latitude</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">Longitude</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scrape DEFRA website to get Easting/Northing (if available)</span></span>
<span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ukair_get_coordinates.html">ukair_get_coordinates</a></span><span class="op">(</span><span class="va">stations</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># How many stations still have missing coordinates?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">Latitude</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">Longitude</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="check-hourly-data-availability">Check hourly data availability<a class="anchor" aria-label="anchor" href="#check-hourly-data-availability"></a>
</h4>
<p>Pollution data started to be collected in 1972 and consists of hourly concentration of various species (in micrograms/m<sup>3</sup>), such as ozone (O<sub>3</sub>), particulate matters (PM<sub>2.5</sub> and PM<sub>10</sub>), nitrogen dioxide (NO<sub>2</sub>), sulphur dioxide (SO<sub>2</sub>), and so on.</p>
<p>The ID under which these data are available differs from the UK.AIR.ID. The catalogue does not contain this additional station ID (called SiteID hereafter) but DEFRAâ€™s web pages contain references to both the UK.AIR.ID and the SiteID. The function below uses as input the UK.AIR.ID and outputs the SiteID, if available.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stations</span><span class="op">$</span><span class="va">SiteID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ukair_get_site_id.html">ukair_get_site_id</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">UK.AIR.ID</span><span class="op">)</span></span></code></pre></div>
<p>Please note this function takes several minutes to run.</p>
</div>
<div class="section level4">
<h4 id="cached-catalogue">Cached catalogue<a class="anchor" aria-label="anchor" href="#cached-catalogue"></a>
</h4>
<p>For convenience, a cached version of the catalogue (last updated in April 2021) is included in the package and can be loaded using the following command:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"stations"</span><span class="op">)</span></span></code></pre></div>
<p>The cached catalogue contains all the available siteIDs and coordinates and can be used offline as lookup table to find out the correspondence between the UK.AIR.ID and SiteID, as well as to investigate station characteristics.</p>
</div>
<div class="section level4">
<h4 id="get-hourly-data">Get hourly data<a class="anchor" aria-label="anchor" href="#get-hourly-data"></a>
</h4>
<p>Once the SiteID is known, time series for a given station can be retrieved in one line of code:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get 1 year of hourly ozone data from London Marylebone Road monitoring station</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ukair_get_hourly_data.html">ukair_get_hourly_data</a></span><span class="op">(</span><span class="st">"MY1"</span>, years <span class="op">=</span> <span class="fl">2015</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Aggregate to daily means and plot</span></span>
<span><span class="co"># please note we use the zoo package here because time series could be irregular</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://zoo.R-Forge.R-project.org/" class="external-link">"zoo"</a></span><span class="op">)</span></span>
<span><span class="va">my1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/zoo.html" class="external-link">zoo</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">Ozone</span>, order.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXlt</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">datetime</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">daily_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">my1</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXlt</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">datetime</span><span class="op">)</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">daily_means</span>, main <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="st">""</span>,</span>
<span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Ozone concentration ["</span>, <span class="va">mu</span>, <span class="st">"g/"</span>, <span class="va">m</span><span class="op">^</span><span class="fl">3</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="get_hourly_data.png" alt=""><p class="caption">get_hourly_data.png</p>
</div>
<p>The above figure <span class="math inline">\(\ref{fig:hdata}\)</span> shows the highest concentrations happen in late spring and at the beginning of summer. In order to check whether this happens every year, we can download multiple years of data and then compare them.</p>
<p>The code below explores the distribution of ozone by month. The resulting box plots show that the highest concentrations usually occurr during April/May and that these vary year-by-year.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get 15 years of hourly ozone data from the same monitoring station</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://lubridate.tidyverse.org" class="external-link">"lubridate"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ukair_get_hourly_data.html">ukair_get_hourly_data</a></span><span class="op">(</span><span class="st">"MY1"</span>, years <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span>,</span>
<span>         month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span>,</span>
<span>         year_month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strptime.html" class="external-link">strftime</a></span><span class="op">(</span><span class="va">datetime</span>, <span class="st">"%Y-%m"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">year_month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>ozone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Ozone</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">na.omit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">ozone</span>, group <span class="op">=</span> <span class="va">month</span><span class="op">)</span>,</span>
<span>               outlier.shape <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Month of the year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Ozone concentration ("</span>, <span class="va">mu</span>, <span class="st">"g/"</span>,<span class="va">m</span><span class="op">^</span><span class="fl">3</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"15 years of hourly ozone data from London Marylebone Road monitoring station"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="ozone_data.png" alt=""><p class="caption">ozone_data.png</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="applications">Applications<a class="anchor" aria-label="anchor" href="#applications"></a>
</h3>
<div class="section level4">
<h4 id="plotting-stations-locations">Plotting stationsâ€™ locations<a class="anchor" aria-label="anchor" href="#plotting-stations-locations"></a>
</h4>
<p>After scraping DEFRAâ€™s web pages, almost all the stations have valid coordinates. You can create an interactive map using leaflet. The code below generates a map where blue circles are all the stations with valid coordinates, while red circles show locations with available hourly data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Keep only station with coordinates</span></span>
<span><span class="va">stations_with_coords</span> <span class="op">&lt;-</span> <span class="va">stations</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">stations</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>,</span>
<span>                                                             <span class="st">"Latitude"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># Keep only station with known SiteID</span></span>
<span><span class="va">stations_with_SiteID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stations_with_coords</span><span class="op">$</span><span class="va">SiteID</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># An interactive map</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://rstudio.github.io/leaflet/" class="external-link">"leaflet"</a></span><span class="op">)</span></span>
<span><span class="fu">leaflet</span><span class="op">(</span>data <span class="op">=</span> <span class="va">stations_with_coords</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span>lng <span class="op">=</span> <span class="op">~</span><span class="va">Longitude</span>, </span>
<span>                   lat <span class="op">=</span> <span class="op">~</span><span class="va">Latitude</span>,  </span>
<span>                   popup <span class="op">=</span> <span class="op">~</span><span class="va">SiteID</span>,</span>
<span>                   radius <span class="op">=</span> <span class="fl">1</span>, color<span class="op">=</span><span class="st">"blue"</span>, fill <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">addCircleMarkers</span><span class="op">(</span>lng <span class="op">=</span> <span class="op">~</span><span class="va">Longitude</span><span class="op">[</span><span class="va">stations_with_SiteID</span><span class="op">]</span>, </span>
<span>                   lat <span class="op">=</span> <span class="op">~</span><span class="va">Latitude</span><span class="op">[</span><span class="va">stations_with_SiteID</span><span class="op">]</span>, </span>
<span>                   radius <span class="op">=</span> <span class="fl">0.5</span>, color<span class="op">=</span><span class="st">"red"</span>, </span>
<span>                   popup <span class="op">=</span> <span class="op">~</span><span class="va">SiteID</span><span class="op">[</span><span class="va">stations_with_SiteID</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="map_data.png" alt=""><p class="caption">map_data.png</p>
</div>
</div>
<div class="section level4">
<h4 id="analyse-the-spatial-distribution-of-the-monitoring-stations">Analyse the spatial distribution of the monitoring stations<a class="anchor" aria-label="anchor" href="#analyse-the-spatial-distribution-of-the-monitoring-stations"></a>
</h4>
<p>Below are two plots showing the spatial distribution of the monitoring stations. These are concentrated largely in urban areas and mostly estimate the background level of concentration of pollutants.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Zone</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/dotchart.html" class="external-link">dotchart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">Zone</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dotchart_zone.png" alt=""><p class="caption">dotchart_zone.png</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Environment.Type</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/dotchart.html" class="external-link">dotchart</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">stations</span><span class="op">$</span><span class="va">Environment.Type</span><span class="op">[</span><span class="va">stations</span><span class="op">$</span><span class="va">Environment.Type</span> <span class="op">!=</span> <span class="st">"Unknown Unknown"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="dotchart_envtype.png" alt=""><p class="caption">dotchart_envtype.png</p>
</div>
</div>
<div class="section level4">
<h4 id="use-multiple-cores-to-speed-up-data-retrieval-from-numerous-sites">Use multiple cores to speed up data retrieval from numerous sites<a class="anchor" aria-label="anchor" href="#use-multiple-cores-to-speed-up-data-retrieval-from-numerous-sites"></a>
</h4>
<p>The acquisition of data from hundreds of sites takes only few minutes:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"parallel"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use detectCores() to find out many cores are available on your machine</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"cl.cores"</span>, <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">myList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapply</a></span><span class="op">(</span><span class="va">cl</span>, <span class="va">stations</span><span class="op">$</span><span class="va">SiteID</span><span class="op">[</span><span class="va">stations_with_SiteID</span><span class="op">]</span>, </span>
<span>                                <span class="va">ukair_get_hourly_data</span>, years<span class="op">=</span><span class="fl">1999</span><span class="op">:</span><span class="fl">2016</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">myList</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
